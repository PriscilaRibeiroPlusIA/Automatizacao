# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1lsV5RX1Gcunz8a9GJwvsgO3tY1-RqNc9
"""

# CÃ©lula 1: Conectar ao Google Drive
from google.colab import drive
drive.mount('/content/drive')

# CÃ©lula 2: Instalar a biblioteca PyPDF2
!pip install PyPDF2

# CÃ©lula 3: Definir o caminho da pasta dos PDFs
import os # Biblioteca para interagir com o sistema de arquivos (pastas e arquivos)

# !!!!! MUITO IMPORTANTE !!!!!
# Substitua o texto abaixo pelo caminho correto da sua pasta de PDFs no Google Drive.
# Exemplo: '/content/drive/MyDrive/Pdfs'
pasta_dos_pdfs = "/content/drive/MyDrive/Pdfs" # <<< SUBSTITUA AQUI

# Vamos verificar se a pasta existe para evitar erros
if not os.path.exists(pasta_dos_pdfs):
    print(f"AtenÃ§Ã£o! A pasta '{pasta_dos_pdfs}' nÃ£o foi encontrada. Verifique o caminho e tente novamente.")
    print("Certifique-se de que o Google Drive estÃ¡ montado e o caminho estÃ¡ correto.")
else:
    print(f"Ok! A pasta de PDFs foi configurada como: {pasta_dos_pdfs}")

# A pasta onde os resumos serÃ£o salvos serÃ¡ a mesma
pasta_dos_resumos = pasta_dos_pdfs

# CÃ©lula 4: Agente 1 - FunÃ§Ã£o para ler textos de arquivos PDF
import PyPDF2 # A biblioteca que instalamos para ler PDFs

def agente_leitor_de_pdfs(caminho_da_pasta_com_pdfs):
    """
    Esta funÃ§Ã£o (nosso "agente leitor") vai atÃ© a pasta especificada,
    encontra todos os arquivos PDF e tenta ler o texto de cada um.
    """
    print(f"\n--- Agente Leitor Ativado: Buscando PDFs em '{caminho_da_pasta_com_pdfs}' ---")
    documentos_lidos = [] # Uma lista vazia para guardar o nome e o texto de cada PDF

    # Vamos olhar cada item dentro da pasta
    for nome_do_arquivo in os.listdir(caminho_da_pasta_com_pdfs):
        # Verificamos se o arquivo termina com ".pdf" (ignorando se Ã© PDF ou pdf)
        if nome_do_arquivo.lower().endswith(".pdf"):
            print(f"Encontrei um PDF: {nome_do_arquivo}")
            caminho_completo_do_arquivo = os.path.join(caminho_da_pasta_com_pdfs, nome_do_arquivo)

            try:
                texto_do_pdf = ""
                # Abrimos o arquivo PDF em modo de leitura binÃ¡ria ('rb')
                with open(caminho_completo_do_arquivo, 'rb') as arquivo_pdf:
                    # Criamos um objeto "leitor de PDF"
                    leitor = PyPDF2.PdfReader(arquivo_pdf)
                    # Vamos passar por cada pÃ¡gina do PDF
                    for numero_pagina in range(len(leitor.pages)):
                        pagina = leitor.pages[numero_pagina]
                        texto_do_pdf += pagina.extract_text() # Extrai o texto da pÃ¡gina

                if texto_do_pdf: # Se conseguimos ler algum texto
                    documentos_lidos.append({
                        "nome_arquivo": nome_do_arquivo,
                        "conteudo_texto": texto_do_pdf
                    })
                    print(f"  Texto extraÃ­do de '{nome_do_arquivo}' com sucesso!")
                else:
                    print(f"  Aviso: NÃ£o consegui extrair texto do '{nome_do_arquivo}' (pode estar vazio ou ser uma imagem).")

            except Exception as e:
                # Se der algum erro ao tentar ler o PDF
                print(f"  Ops! Ocorreu um erro ao tentar ler o arquivo '{nome_do_arquivo}': {e}")

    if not documentos_lidos:
        print("Nenhum texto de PDF foi extraÃ­do. Verifique se hÃ¡ PDFs na pasta ou se eles contÃªm texto selecionÃ¡vel.")
    else:
        print(f"--- Agente Leitor ConcluÃ­do: {len(documentos_lidos)} PDF(s) processados. ---")
    return documentos_lidos

# Para testar (opcional, vamos rodar tudo junto no final):
# lista_de_textos_dos_pdfs = agente_leitor_de_pdfs(pasta_dos_pdfs)
# print(f"\nEncontrei {len(lista_de_textos_dos_pdfs)} PDFs com texto.")

# CÃ©lula 5: Agente 2 - FunÃ§Ã£o para extrair informaÃ§Ãµes do texto
import re # Biblioteca para "ExpressÃµes Regulares" (busca avanÃ§ada de texto)

def agente_extrator_de_informacoes(texto_do_documento):
    """
    Este "agente extrator" recebe o texto de um documento e tenta
    encontrar nome, CPF, endereÃ§o do autor e a decisÃ£o/sentenÃ§a/acÃ³rdÃ£o.
    """
    # print("\n--- Agente Extrator Ativado: Analisando texto... ---")
    informacoes = {
        "nome_autor": "NÃ£o encontrado",
        "cpf_autor": "NÃ£o encontrado",
        "endereco_autor": "NÃ£o encontrado",
        "tipo_decisao": "NÃ£o especificado", # Para "DecisÃ£o", "SentenÃ§a" ou "AcÃ³rdÃ£o"
        "resumo_decisao": "NÃ£o encontrado"
    }

    # Tentar encontrar NOME DO AUTOR
    # Procuramos por "Autor(a):", "Requerente:", "Parte Autora:" seguido de um nome.
    # [A-Za-zÃ€-Ãº\s]+ significa "uma ou mais letras (maiÃºsculas, minÃºsculas, com acento) e espaÃ§os"
    # O '?' depois de \s* faz a busca ser "nÃ£o gulosa", parando no primeiro \n (nova linha) ou CPF
    match_nome = re.search(r"(?:Autor\(a\)|Requerente|Parte Autora|Exequente)\s*:\s*([A-Za-zÃ€-Ãº\s]+?)(?:\n|CPF)", texto_do_documento, re.IGNORECASE)
    if match_nome:
        informacoes["nome_autor"] = match_nome.group(1).strip() # .group(1) pega o que estÃ¡ nos parÃªnteses () da regex

    # Tentar encontrar CPF DO AUTOR
    # Procuramos por "CPF:" seguido de nÃºmeros no formato XXX.XXX.XXX-XX ou XXXXXXXXXXX
    match_cpf = re.search(r"CPF\s*(?:nÂº|:)?\s*(\d{3}\.\d{3}\.\d{3}-\d{2}|\d{11})", texto_do_documento, re.IGNORECASE)
    if match_cpf:
        informacoes["cpf_autor"] = match_cpf.group(1).strip()

    # Tentar encontrar ENDEREÃ‡O DO AUTOR
    # Esta Ã© a parte mais difÃ­cil, pois endereÃ§os variam muito.
    # Procuramos por "EndereÃ§o:" seguido de qualquer texto atÃ© uma nova linha ou palavras como CEP, Cidade.
    # re.DOTALL faz o '.' na regex tambÃ©m pegar quebras de linha, mas limitamos a busca.
    # Esta regex Ã© um EXEMPLO e provavelmente precisarÃ¡ de ajustes!
    match_endereco = re.search(r"(?:EndereÃ§o|ENDEREÃ‡O)\s*:\s*(.+?)(?:\n\s*(?:CEP|Cidade|Bairro|Estado)|Processo NÂº|CITADO\(A\))", texto_do_documento, re.IGNORECASE | re.DOTALL)
    if match_endereco:
        # Remove quebras de linha excessivas do endereÃ§o
        endereco_limpo = re.sub(r'\s*\n\s*', ' ', match_endereco.group(1).strip())
        informacoes["endereco_autor"] = endereco_limpo
    else: # Tentativa mais simples se a primeira falhar
        match_endereco_simples = re.search(r"residente\s+e\s+domiciliado(?:a)?\s+Ã \s+(.+?)(?:,|\.|CEP|nÂº)", texto_do_documento, re.IGNORECASE | re.DOTALL)
        if match_endereco_simples:
            endereco_limpo = re.sub(r'\s*\n\s*', ' ', match_endereco_simples.group(1).strip())
            informacoes["endereco_autor"] = endereco_limpo


    # Tentar encontrar TIPO DE DECISÃƒO e um RESUMO
    texto_lower = texto_do_documento.lower() # Para facilitar a busca por palavras-chave
    palavras_chave_decisao = ["decisÃ£o", "sentenÃ§a", "acÃ³rdÃ£o"]
    indice_inicio_decisao = -1

    for palavra in palavras_chave_decisao:
        # Procuramos a palavra cercada por espaÃ§os ou no inÃ­cio/fim de uma frase, para evitar falsos positivos
        # como "decisÃ£oprocessual"
        match_palavra_chave = re.search(r"\b" + palavra + r"\b", texto_lower)
        if match_palavra_chave:
            informacoes["tipo_decisao"] = palavra.capitalize()
            indice_inicio_decisao = match_palavra_chave.start() # Onde a palavra foi encontrada
            break # Para na primeira que encontrar (DecisÃ£o, depois SentenÃ§a, depois AcÃ³rdÃ£o)

    if indice_inicio_decisao != -1:
        # Pega um trecho do texto comeÃ§ando da palavra-chave encontrada.
        # O "resumo" aqui serÃ¡ os prÃ³ximos 1000 caracteres apÃ³s a palavra-chave.
        # Isso Ã© uma simplificaÃ§Ã£o! Um resumo de verdade Ã© mais complexo.
        texto_apos_palavra_chave = texto_do_documento[indice_inicio_decisao:]

        # Tenta encontrar frases comuns de julgamento para um "resumo" mais focado
        # (JULGO PROCEDENTE..., CONDENO..., NEGO PROVIMENTO..., etc.)
        # (?:.|\n) significa "qualquer caractere OU uma nova linha"
        match_julgamento = re.search(r"(JULGO\s+(?:PARCIALMENTE\s+)?PROCEDENTE|JULGO\s+IMPROCEDENTE|NEGO\s+PROVIMENTO|DOU\s+(?:PARCIAL\s+)?PROVIMENTO|CONDENO|ABSOLVO|DECRETO|MANTENHO\s+A\s+SENTENÃ‡A|REFORMO\s+A\s+SENTENÃ‡A)(?:.|\n){0,500}", texto_apos_palavra_chave, re.IGNORECASE | re.DOTALL)
        if match_julgamento:
            # Pega atÃ© 500 caracteres do trecho do julgamento.
            resumo_bruto = match_julgamento.group(0).strip()
            informacoes["resumo_decisao"] = re.sub(r'\s+', ' ', resumo_bruto[:500]) + "..." # Limpa espaÃ§os extras
        else:
            # Se nÃ£o achar frases de julgamento, pega um trecho genÃ©rico
            resumo_bruto = texto_apos_palavra_chave[:1000].strip()
            informacoes["resumo_decisao"] = re.sub(r'\s+', ' ', resumo_bruto) + "..." # Limpa espaÃ§os extras
    else:
        informacoes["resumo_decisao"] = "Palavra-chave (DecisÃ£o/SentenÃ§a/AcÃ³rdÃ£o) nÃ£o encontrada no texto ou texto subsequente nÃ£o capturado."

    # print("--- Agente Extrator ConcluÃ­do. ---")
    return informacoes

# Para testar (opcional):
# if lista_de_textos_dos_pdfs: # Se a lista nÃ£o estiver vazia
#     texto_exemplo = lista_de_textos_dos_pdfs[0]["conteudo_texto"] # Pega o texto do primeiro PDF
#     infos_exemplo = agente_extrator_de_informacoes(texto_exemplo)
#     print("\nInformaÃ§Ãµes extraÃ­das do primeiro PDF (exemplo):")
#     for chave, valor in infos_exemplo.items():
#         print(f"  {chave}: {valor[:100]}...") # Mostra sÃ³ os primeiros 100 caracteres

# CÃ©lula 6: Agente 3 - FunÃ§Ã£o para salvar os dados extraÃ­dos em um arquivo de texto
def agente_arquivista(dados_para_salvar, nome_do_pdf_original, caminho_da_pasta_para_salvar):
    """
    Este "agente arquivista" pega os dados extraÃ­dos e os salva
    em um arquivo .txt na pasta especificada.
    O nome do arquivo de resumo serÃ¡ baseado no nome do PDF original.
    """
    # print(f"\n--- Agente Arquivista Ativado: Preparando para salvar resumo de '{nome_do_pdf_original}' ---")
    # Cria um nome para o arquivo de resumo. Ex: se o PDF Ã© "processo123.pdf", o resumo serÃ¡ "resumo_processo123.txt"
    nome_arquivo_resumo = "RESUMO_" + nome_do_pdf_original.replace(".pdf", ".txt").replace(".PDF", ".txt")
    caminho_completo_do_resumo = os.path.join(caminho_da_pasta_para_salvar, nome_arquivo_resumo)

    try:
        # Abre (ou cria se nÃ£o existir) o arquivo de resumo em modo de escrita ('w')
        # encoding='utf-8' ajuda com acentos e caracteres especiais
        with open(caminho_completo_do_resumo, 'w', encoding='utf-8') as arquivo_saida:
            arquivo_saida.write(f"Arquivo Original: {nome_do_pdf_original}\n")
            arquivo_saida.write("=" * 40 + "\n") # Uma linha separadora
            arquivo_saida.write(f"Nome do Autor: {dados_para_salvar['nome_autor']}\n")
            arquivo_saida.write(f"CPF do Autor: {dados_para_salvar['cpf_autor']}\n")
            arquivo_saida.write(f"EndereÃ§o do Autor: {dados_para_salvar['endereco_autor']}\n")
            arquivo_saida.write("-" * 40 + "\n") # Outra linha separadora
            arquivo_saida.write(f"Tipo de DecisÃ£o/Documento: {dados_para_salvar['tipo_decisao']}\n")
            arquivo_saida.write(f"ConteÃºdo Principal da DecisÃ£o/SentenÃ§a/AcÃ³rdÃ£o:\n{dados_para_salvar['resumo_decisao']}\n")

        print(f"  Sucesso! Resumo salvo em: {caminho_completo_do_resumo}")
    except Exception as e:
        print(f"  Ops! Ocorreu um erro ao tentar salvar o resumo '{nome_arquivo_resumo}': {e}")

# Para testar (opcional):
# if lista_de_textos_dos_pdfs and infos_exemplo: # Se tivermos dados de exemplo
#     agente_arquivista(infos_exemplo, lista_de_textos_dos_pdfs[0]["nome_arquivo"], pasta_dos_resumos)

# CÃ©lula 7: Executando o projeto completo - Orquestrando os agentes

print("=======================================================")
print("ðŸ¤– INICIANDO PROJETO DE EXTRAÃ‡ÃƒO DE INFORMAÃ‡Ã•ES JUDICIAIS ðŸ¤–")
print("=======================================================")

# Verifica se a pasta dos PDFs foi configurada corretamente (da CÃ©lula 3)
if 'pasta_dos_pdfs' not in globals() or not os.path.exists(pasta_dos_pdfs):
    print("\nâŒ ERRO: A variÃ¡vel 'pasta_dos_pdfs' nÃ£o foi definida ou a pasta nÃ£o existe.")
    print("Por favor, execute a CÃ©lula 3 (Definir o caminho da pasta dos PDFs) corretamente.")
    print("Certifique-se de que o Google Drive estÃ¡ montado e o caminho estÃ¡ correto.")
else:
    print(f"\nðŸ”Ž Usando a pasta de PDFs: {pasta_dos_pdfs}")
    print(f"ðŸ“ Os resumos serÃ£o salvos em: {pasta_dos_resumos}")

    # ---- AGENTE 1: LER OS PDFs ----
    # Chamamos a funÃ§Ã£o que definimos na CÃ©lula 4
    lista_documentos_com_texto = agente_leitor_de_pdfs(pasta_dos_pdfs)

    if not lista_documentos_com_texto:
        print("\nâš ï¸ Nenhum documento PDF foi lido ou nenhum texto pÃ´de ser extraÃ­do. O programa nÃ£o pode continuar.")
    else:
        print(f"\nðŸ‘ Agente Leitor finalizou. Total de {len(lista_documentos_com_texto)} documento(s) com texto para analisar.")
        print("-------------------------------------------------------")

        contador_sucessos = 0
        # Vamos passar por cada documento que o Agente 1 leu
        for i, documento_atual in enumerate(lista_documentos_com_texto):
            nome_arquivo = documento_atual["nome_arquivo"]
            texto_completo = documento_atual["conteudo_texto"]

            print(f"\nðŸ“„ Processando documento {i+1}/{len(lista_documentos_com_texto)}: {nome_arquivo}")

            # ---- AGENTE 2: EXTRAIR INFORMAÃ‡Ã•ES ----
            # Chamamos a funÃ§Ã£o que definimos na CÃ©lula 5
            print("   ðŸ§  Agente Extrator iniciando...")
            informacoes_extraidas = agente_extrator_de_informacoes(texto_completo)

            # Mostra um resumo do que foi encontrado (ou nÃ£o)
            print("      InformaÃ§Ãµes encontradas (prÃ©via):")
            for chave, valor in informacoes_extraidas.items():
                valor_prev = str(valor)
                if len(valor_prev) > 70: # Se o valor for muito longo, mostra sÃ³ o comeÃ§o
                    valor_prev = valor_prev[:70] + "..."
                print(f"         - {chave.replace('_', ' ').capitalize()}: {valor_prev}")


            # ---- AGENTE 3: SALVAR AS INFORMAÃ‡Ã•ES ----
            # Chamamos a funÃ§Ã£o que definimos na CÃ©lula 6
            print("   ðŸ’¾ Agente Arquivista iniciando...")
            agente_arquivista(informacoes_extraidas, nome_arquivo, pasta_dos_resumos)
            contador_sucessos +=1
            print("-------------------------------------------------------")

        print(f"\nðŸŽ‰ Processamento ConcluÃ­do! ðŸŽ‰")
        if contador_sucessos > 0:
            print(f"Foram processados e salvos resumos para {contador_sucessos} documento(s).")
            print(f"Verifique a pasta '{pasta_dos_resumos}' no seu Google Drive pelos arquivos 'RESUMO_...'")
        else:
            print("Nenhum resumo foi gerado. Verifique as mensagens anteriores para possÃ­veis avisos ou erros.")

print("\n=======================================================")
print("ðŸ¤– FIM DO PROJETO ðŸ¤–")
print("=======================================================")